<!DOCTYPE html>
<html lang="es">
<head><meta charset="UTF-8" /><title>Toggle Reporte</title></head>
<body>
  <button onclick="generarReporte()">ðŸ“Š Ver Reporte</button>
  <div id="reporte-semanal" style="display:none;">
    <div id="reporte-contenido">AquÃ­ va el reporte...</div>
  </div>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBcla-wEjFVTBZolxttysM_N8q_fYuLSAE",
      authDomain: "reloj-e5ff7.firebaseapp.com",
      databaseURL: "https://reloj-e5ff7-default-rtdb.firebaseio.com",
      projectId: "reloj-e5ff7",
      storageBucket: "reloj-e5ff7.appspot.com",
      messagingSenderId: "694363221214",
      appId: "1:694363221214:web:dad4c89caff0b1d550264f"
    };
    firebase.initializeApp(firebaseConfig);

    function formatear(s) {
      const h = String(Math.floor(s / 3600)).padStart(2, '0');
      const m = String(Math.floor((s % 3600) / 60)).padStart(2, '0');
      const sec = String(s % 60).padStart(2, '0');
      return `${h}:${m}:${sec}`;
    }
    
function generarReporte() {
  const reporteDiv = document.getElementById("reporte-semanal");
  const reporteContenido = document.getElementById("reporte-contenido");

  // Alternar visibilidad
  if (reporteDiv.style.display === "block") {
    reporteDiv.style.display = "none";
    return;
  }

  reporteContenido.innerHTML = "Cargando reporte...";
  reporteDiv.style.display = "block";

  const hoy = new Date();
  const fechas = [];
  for (let i = 0; i < 7; i++) {
    const d = new Date(hoy);
    d.setDate(hoy.getDate() - i);
    fechas.push(d.toISOString().slice(0, 10));
  }
  fechas.reverse();

  const promesas = fechas.map(fecha => {
    return firebase.database().ref(`reloj/registrosDiarios/${fecha}`).get().then(snap => {
      const data = snap.val();
      return {
        fecha: fecha,
        juegoSinPantalla: data ? (data.juegoSinPantalla || 0) : 0,
        usoDePantalla: data ? (data.usoDePantalla || 0) : 0
      };
    }).catch(() => ({
      fecha: fecha, juegoSinPantalla: 0, usoDePantalla: 0
    }));
  });

  Promise.all(promesas).then(resultados => {
    let htmlReporte = '';
    resultados.forEach(dia => {
      const fechaFormateada = new Date(dia.fecha + 'T00:00:00').toLocaleDateString('es-AR', {
        weekday: 'short', month: 'numeric', day: 'numeric'
      });
      htmlReporte += `
        <div class="reporte-dia">
          <span>${fechaFormateada}</span>
          <span>ðŸŸ¢ ${formatear(dia.juegoSinPantalla)}</span>
          <span>ðŸ”´ ${formatear(dia.usoDePantalla)}</span>
        </div>
      `;
    });
    reporteContenido.innerHTML = htmlReporte;
  }).catch(() => {
    reporteContenido.innerHTML = "No se pudo cargar el reporte.";
  });
}

  </script>
</body>
</html>
